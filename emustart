-- Wait for LocalPlayer
repeat wait() until game.Players.LocalPlayer

-- Services 
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")

-- Cache tables
local gameIconCache = {}

-- Get player info
local player = Players.LocalPlayer
local username = player.Name
local displayName = player.DisplayName
local userId = player.UserId
local playerNameFormatted = string.format("%s (@%s)", displayName, username)

-- ‚úÖ Game Icon Cache
function getGameIcon(placeId)
	if gameIconCache[placeId] then
		return true, gameIconCache[placeId]
	end

	local url = "https://thumbnails.roproxy.com/v1/games/icons?universeIds=" .. placeId .. "&size=150x150&format=Png"
	local response = HttpService:RequestAsync({ Url = url, Method = "GET" })

	if response.Success then
		local data = HttpService:JSONDecode(response.Body)
		local info = data["data"][tostring(placeId)]
		if info and info["imageUrl"] then
			gameIconCache[placeId] = info["imageUrl"]
			return true, info["imageUrl"]
		end
	end
	return false, nil
end

-- Device type
local deviceType = "Unknown"
if UserInputService.TouchEnabled then
	deviceType = "Mobile"
elseif UserInputService.GamepadEnabled then
	deviceType = "Console"
elseif UserInputService.KeyboardEnabled then
	deviceType = "PC"
end

local gameSuccess, gameInfo = pcall(function()
	return MarketplaceService:GetProductInfo(game.PlaceId)
end)

local gameName = gameSuccess and gameInfo.Name or "Unknown Game"
local placeId = game.PlaceId

local gameIconSuccess, gameIconUrl = getGameIcon(placeId)
if not gameIconSuccess then gameIconUrl = nil end

-- Replace serverRegion with JobId
local jobId = game.JobId

local isoTime = os.date("!%Y-%m-%dT%H:%M:%SZ")

-- Build Discord embed
local embed = {
	title = "üîÅ Emulator Restart",
	description = "**A Roblox emulator restarted and rejoined the game.**",
	color = 0x3498DB,
	fields = {
		{
			name = "üë§ Player",
			value = playerNameFormatted,
			inline = true
		},
		{
			name = "üíª Device",
			value = deviceType,
			inline = true
		},
		{
			name = "üìç Game",
			value = gameName,
			inline = false
		},
		{
			name = "üÜî Place ID",
			value = tostring(placeId),
			inline = true
		},
		{
			name = "üÜî Job ID",
			value = jobId,
			inline = true
		}
	},
	footer = {
		text = "Emulator Logger"
	},
	timestamp = isoTime
}

if gameIconUrl then
	embed.image = { url = gameIconUrl }
end

-- Send to Discord
function SendEmbed(url, embed)
	local payload = HttpService:JSONEncode({ embeds = { embed } })
	local response = request({
		Url = url,
		Method = "POST",
		Headers = { ["Content-Type"] = "application/json" },
		Body = payload
	})
	print("Embed sent.")
end

-- ‚úÖ Replace this with your actual webhook

SendEmbed(webhookUrl, embed)
